From e22a5cec707388233213415ca52f4367da3d9d55 Mon Sep 17 00:00:00 2001
From: Vitaly Lipatov <lav@etersoft.ru>
Date: Fri, 21 Mar 2025 18:23:32 +0300
Subject: [PATCH 258/365] wow64: Skip memcpy for null pointer.

Wine-Bug: https://bugs.winehq.org/show_bug.cgi?id=56154
---
 dlls/wow64/security.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/dlls/wow64/security.c b/dlls/wow64/security.c
index 49f4adea3c1..a7616331600 100644
--- a/dlls/wow64/security.c
+++ b/dlls/wow64/security.c
@@ -471,7 +471,7 @@ NTSTATUS WINAPI wow64_NtQueryInformationToken( UINT *args )
         if (!status)
         {
             dacl32->DefaultDacl = dacl->DefaultDacl ? PtrToUlong( dacl32 + 1 ) : 0;
-            memcpy( dacl32 + 1, dacl->DefaultDacl, ret_size - sizeof(*dacl) );
+            if (dacl->DefaultDacl) memcpy( dacl32 + 1, dacl->DefaultDacl, ret_size - sizeof(*dacl) );
         }
         if (retlen) *retlen = ret_size + sizeof(*dacl32) - sizeof(*dacl);
         return status;
-- 
2.50.1

