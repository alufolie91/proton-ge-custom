From 758b2aba45b410e9cfe89d13d77d6604302ebe46 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Tue, 22 Jul 2025 21:23:12 -0400
Subject: [PATCH 204/365] ntoskrnl: Implement PsGetProcessExitStatus.

---
 dlls/ntoskrnl.exe/ntoskrnl.c        | 18 ++++++++++++++++++
 dlls/ntoskrnl.exe/ntoskrnl.exe.spec |  2 +-
 2 files changed, 19 insertions(+), 1 deletion(-)

diff --git a/dlls/ntoskrnl.exe/ntoskrnl.c b/dlls/ntoskrnl.exe/ntoskrnl.c
index ac3484d36e8..9d0b85cb0de 100644
--- a/dlls/ntoskrnl.exe/ntoskrnl.c
+++ b/dlls/ntoskrnl.exe/ntoskrnl.c
@@ -2562,6 +2562,24 @@ LONGLONG WINAPI PsGetProcessCreateTimeQuadPart( PEPROCESS process )
     return process->times.CreateTime.QuadPart;
 }
 
+/*********************************************************************
+ *           PsGetProcessExitStatus    (NTOSKRNL.@)
+ */
+NTSTATUS WINAPI PsGetProcessExitStatus( PEPROCESS process )
+{
+    PROCESS_BASIC_INFORMATION info;
+    HANDLE handle, id = PsGetProcessId(process);
+
+    if (!(handle = OpenProcess( PROCESS_ALL_ACCESS, FALSE, HandleToUlong(id) )))
+        return STATUS_SUCCESS;
+
+    NtQueryInformationProcess(handle, ProcessBasicInformation,
+                              &info, sizeof(info), NULL);
+    NtClose(handle);
+    TRACE("%p -> %lx\n", process, info.ExitStatus);
+    return info.ExitStatus;
+}
+
 static void *create_thread_object( HANDLE handle )
 {
     THREAD_BASIC_INFORMATION info;
diff --git a/dlls/ntoskrnl.exe/ntoskrnl.exe.spec b/dlls/ntoskrnl.exe/ntoskrnl.exe.spec
index f82202c000e..22d04cf949a 100644
--- a/dlls/ntoskrnl.exe/ntoskrnl.exe.spec
+++ b/dlls/ntoskrnl.exe/ntoskrnl.exe.spec
@@ -924,7 +924,7 @@
 @ stdcall PsGetProcessCreateTimeQuadPart(ptr)
 @ stub PsGetProcessDebugPort
 @ stub PsGetProcessExitProcessCalled
-@ stub PsGetProcessExitStatus
+@ stdcall PsGetProcessExitStatus(ptr)
 @ stub PsGetProcessExitTime
 @ stdcall PsGetProcessId(ptr)
 @ stub PsGetProcessImageFileName
-- 
2.50.1

