From 4191f3139674731030f1d0642a9d4d20d9b5c8e6 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Fri, 5 Sep 2025 23:31:13 -0500
Subject: [PATCH 297/378] winewayland: Add env to disable IME.

---
 dlls/winewayland.drv/wayland.c | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/dlls/winewayland.drv/wayland.c b/dlls/winewayland.drv/wayland.c
index 30603eccdae..cdb30de062a 100644
--- a/dlls/winewayland.drv/wayland.c
+++ b/dlls/winewayland.drv/wayland.c
@@ -86,6 +86,23 @@ static const struct wl_seat_listener seat_listener =
     wl_seat_handle_name
 };
 
+static BOOL check_ime_disabled(void)
+{
+    static int cached = -1;
+
+    if (cached == -1)
+    {
+        const char *env = getenv("WAYLANDDRV_NO_IME");
+
+        if (env && !strcmp(env, "1"))
+            cached = 1;
+        else
+            cached = 0;
+    }
+
+    return cached;
+}
+
 /**********************************************************************
  *          Registry handling
  */
@@ -175,6 +192,7 @@ static void registry_handle_global(void *data, struct wl_registry *registry,
     }
     else if (strcmp(interface, "zwp_text_input_manager_v3") == 0)
     {
+        if (check_ime_disabled()) return;
         process_wayland.zwp_text_input_manager_v3 =
             wl_registry_bind(registry, id, &zwp_text_input_manager_v3_interface, 1);
         if (process_wayland.seat.wl_seat) wayland_text_input_init();
-- 
2.51.0

