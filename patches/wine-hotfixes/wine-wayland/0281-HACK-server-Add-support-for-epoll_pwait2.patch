From c49007e614b5fb226cdad1853e17e117c7a85d12 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Wed, 13 Aug 2025 15:44:25 -0400
Subject: [PATCH 281/335] HACK: server: Add support for epoll_pwait2.

---
 server/fd.c | 19 +++++++++++++++++++
 1 file changed, 19 insertions(+)

diff --git a/server/fd.c b/server/fd.c
index 1809d4a0419..90258b386ab 100644
--- a/server/fd.c
+++ b/server/fd.c
@@ -578,6 +578,25 @@ static inline void remove_epoll_user( struct fd *fd, int user )
     }
 }
 
+/* HACK: Add syscall for epoll_pwait2 */
+#ifndef HAVE_EPOLL_PWAIT2
+#ifdef HAVE_SYS_SYSCALL_H
+#define HAVE_EPOLL_PWAIT2
+
+#ifndef __NR_epoll_pwait2
+#define __NR_epoll_pwait2 441
+#endif
+
+int epoll_pwait2(int epfd, struct epoll_event *events,
+                      int maxevents, const struct timespec *timeout,
+                      const sigset_t *sigmask)
+{
+    return syscall(__NR_epoll_pwait2, epfd, events, maxevents, timeout, sigmask);
+}
+
+#endif
+#endif
+
 static inline void main_loop_epoll(void)
 {
     int i, ret, timeout;
-- 
2.51.0

