From 91cbe70053b438db614ee98617e28f1b3b8cec1a Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Mon, 1 Dec 2025 10:45:35 -0600
Subject: [PATCH 407/409] winewayland: Check for desktop window before using
 opwr workarounds.

---
 dlls/winewayland.drv/vulkan.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/dlls/winewayland.drv/vulkan.c b/dlls/winewayland.drv/vulkan.c
index aa67378dc0f..9b2e1ef8188 100644
--- a/dlls/winewayland.drv/vulkan.c
+++ b/dlls/winewayland.drv/vulkan.c
@@ -100,7 +100,8 @@ static VkResult wayland_vulkan_surface_create(HWND hwnd, const struct vulkan_ins
     tid = NtUserGetWindowThread(hwnd, &pid);
     if (tid && pid != GetCurrentProcessId())
     {
-        if (vulkan_opwr_disabled()) return VK_ERROR_OUT_OF_HOST_MEMORY;
+        if (vulkan_opwr_disabled() && hwnd != NtUserGetDesktopWindow())
+            return VK_ERROR_OUT_OF_HOST_MEMORY;
 
         ERR("Cross process rendering is not supported!\n");
         return VK_ERROR_OUT_OF_HOST_MEMORY;
-- 
2.51.1

