From d4564242ff69766487d18b6165733ff210126f4a Mon Sep 17 00:00:00 2001
From: Attila Fidan <dev@print0.net>
Date: Thu, 20 Mar 2025 11:45:41 +0000
Subject: [PATCH 017/336] win32u: Return 0 from NtUserGetKeyNameText if there
 is no translation.

---
 dlls/win32u/input.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/dlls/win32u/input.c b/dlls/win32u/input.c
index 58fa4a291d6..78780933a79 100644
--- a/dlls/win32u/input.c
+++ b/dlls/win32u/input.c
@@ -1296,7 +1296,7 @@ INT WINAPI NtUserGetKeyNameText( LONG lparam, WCHAR *buffer, INT size )
         HKL hkl = NtUserGetKeyboardLayout( 0 );
         vkey = NtUserMapVirtualKeyEx( code & 0xff, MAPVK_VSC_TO_VK, hkl );
         buffer[0] = NtUserMapVirtualKeyEx( vkey, MAPVK_VK_TO_CHAR, hkl );
-        len = 1;
+        len = buffer[0] ? 1 : 0;
     }
     buffer[len] = 0;
 
-- 
2.51.0

