From 73bd6c1948b3997f6a8f4e41f03a55c5d7c13525 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Wed, 19 Nov 2025 01:20:22 -0600
Subject: [PATCH 390/423] winewayland: Separate swiss german and german scanvk
 mappings.

---
 dlls/winewayland.drv/wayland_keyboard.c | 14 +++++++++++++-
 1 file changed, 13 insertions(+), 1 deletion(-)

diff --git a/dlls/winewayland.drv/wayland_keyboard.c b/dlls/winewayland.drv/wayland_keyboard.c
index 926df4d8f11..ec72d75f0ff 100644
--- a/dlls/winewayland.drv/wayland_keyboard.c
+++ b/dlls/winewayland.drv/wayland_keyboard.c
@@ -133,6 +133,18 @@ static const USHORT scan2vk_azerty[0x280] =
     EXTRA_SCAN2VK
 };
 
+/* the original qwertz layout was actually the swiss one.
+ * This doesn't match normal german layout virtual key mappings */
+static const USHORT scan2vk_qwertz_swiss[0x280] =
+{
+    T00, T01, T02, T03, T04, T05, T06, T07, T08, T09, T0A, T0B, VK_OEM_4, VK_OEM_6, T0E,
+    T0F, T10, T11, T12, T13, T14, 'Z', T16, T17, T18, T19, VK_OEM_1, VK_OEM_3, T1C,
+    T1D, T1E, T1F, T20, T21, T22, T23, T24, T25, T26, VK_OEM_7, VK_OEM_5, VK_OEM_2,
+    T2A, VK_OEM_8, 'Y', T2D, T2E, T2F, T30, T31, T32, T33, T34, VK_OEM_MINUS,
+    EXTRA_SCAN2VK
+};
+
+/* TODO: Fix using https://kbdlayout.info/kbdgr/virtualkeys+scancodes?arrangement=ISO105 */
 static const USHORT scan2vk_qwertz[0x280] =
 {
     T00, T01, T02, T03, T04, T05, T06, T07, T08, T09, T0A, T0B, VK_OEM_4, VK_OEM_6, T0E,
@@ -499,7 +511,7 @@ static void add_xkb_layout(const char *xkb_layout, struct xkb_keymap *xkb_keymap
     {
     case MAKELANGID(LANG_FRENCH, SUBLANG_DEFAULT): scan2vk = scan2vk_azerty; break;
     case MAKELANGID(LANG_GERMAN, SUBLANG_DEFAULT): scan2vk = scan2vk_qwertz; break;
-    case MAKELANGID(LANG_GERMAN, SUBLANG_GERMAN_SWISS): scan2vk = scan2vk_qwertz; break;
+    case MAKELANGID(LANG_GERMAN, SUBLANG_GERMAN_SWISS): scan2vk = scan2vk_qwertz_swiss; break;
     default: scan2vk = scan2vk_qwerty; break;
     }
     if (strstr(xkb_layout, "dvorak")) scan2vk = scan2vk_dvorak;
-- 
2.52.0

