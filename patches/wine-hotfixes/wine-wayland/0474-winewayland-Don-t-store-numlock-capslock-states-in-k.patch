From ec874c314ce2a25f581eb631b9bb89324fec6d50 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Mon, 5 Jan 2026 01:40:28 -0500
Subject: [PATCH 474/479] winewayland: Don't store numlock/capslock states in
 keyboard structure.

---
 dlls/winewayland.drv/wayland_keyboard.c | 14 ++++++--------
 dlls/winewayland.drv/waylanddrv.h       |  2 --
 2 files changed, 6 insertions(+), 10 deletions(-)

diff --git a/dlls/winewayland.drv/wayland_keyboard.c b/dlls/winewayland.drv/wayland_keyboard.c
index cf2922973b7..c0febcbca4b 100644
--- a/dlls/winewayland.drv/wayland_keyboard.c
+++ b/dlls/winewayland.drv/wayland_keyboard.c
@@ -1042,8 +1042,12 @@ static void sync_mod_state(HWND hwnd)
     if (!NtUserGetAsyncKeyboardState(state)) return;
 
     pthread_mutex_lock(&keyboard->mutex);
-    numlock_active = keyboard->numlock_active;
-    caplock_active = keyboard->caplock_active;
+    numlock_active = xkb_state_mod_name_is_active(keyboard->xkb_state,
+                                                  XKB_MOD_NAME_NUM,
+                                                  XKB_STATE_MODS_LOCKED) > 0;
+    caplock_active = xkb_state_mod_name_is_active(keyboard->xkb_state,
+                                                  XKB_MOD_NAME_CAPS,
+                                                  XKB_STATE_MODS_LOCKED) > 0;
     pthread_mutex_unlock(&keyboard->mutex);
 
     numlock_changed = (!!(state[VK_NUMLOCK] & 0x1) != numlock_active)
@@ -1143,12 +1147,6 @@ static void keyboard_handle_modifiers(void *data, struct wl_keyboard *wl_keyboar
     pthread_mutex_lock(&keyboard->mutex);
     xkb_state_update_mask(keyboard->xkb_state, mods_depressed, mods_latched,
                           mods_locked, 0, 0, xkb_group);
-    keyboard->numlock_active = xkb_state_mod_name_is_active(keyboard->xkb_state,
-                                                            XKB_MOD_NAME_NUM,
-                                                            XKB_STATE_MODS_LOCKED) > 0;
-    keyboard->caplock_active = xkb_state_mod_name_is_active(keyboard->xkb_state,
-                                                            XKB_MOD_NAME_CAPS,
-                                                            XKB_STATE_MODS_LOCKED) > 0;
     pthread_mutex_unlock(&keyboard->mutex);
 
     set_current_xkb_group(xkb_group);
diff --git a/dlls/winewayland.drv/waylanddrv.h b/dlls/winewayland.drv/waylanddrv.h
index 3cace77bfbb..a6a3cf76b83 100644
--- a/dlls/winewayland.drv/waylanddrv.h
+++ b/dlls/winewayland.drv/waylanddrv.h
@@ -121,8 +121,6 @@ struct wayland_keyboard
     struct wl_keyboard *wl_keyboard;
     struct xkb_context *xkb_context;
     struct xkb_state *xkb_state;
-    BOOL numlock_active;
-    BOOL caplock_active;
     HWND focused_hwnd;
     pthread_mutex_t mutex;
 };
-- 
2.52.0

