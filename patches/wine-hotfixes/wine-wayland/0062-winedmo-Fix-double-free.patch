From e3664fe3f9b0cde0fda46cc54bee9eda88dfc5da Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Sat, 24 May 2025 13:26:50 -0400
Subject: [PATCH 062/414] winedmo: Fix double free

---
 dlls/winedmo/unix_demuxer_mediaconv.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/dlls/winedmo/unix_demuxer_mediaconv.c b/dlls/winedmo/unix_demuxer_mediaconv.c
index 1031a3acb96..9fd6c0aef68 100644
--- a/dlls/winedmo/unix_demuxer_mediaconv.c
+++ b/dlls/winedmo/unix_demuxer_mediaconv.c
@@ -211,6 +211,7 @@ int mediaconv_demuxer_open( AVFormatContext **ctx, struct stream_context *contex
         WARN( "Failed to find decoder for stream %u, codec %#x %s\n", i, par->codec_id, avcodec_get_name(par->codec_id) );
         avio_context_free( &(*ctx)->pb );
         avformat_free_context( *ctx );
+        *ctx = NULL;
     }
 
     if (!(buffer = calloc( 1, HASH_CHUNK_SIZE ))) return AVERROR(ENOMEM);
@@ -260,6 +261,7 @@ int mediaconv_demuxer_open( AVFormatContext **ctx, struct stream_context *contex
                                                NULL, mediaconv_demuxer_seek_callback )))
         {
             avformat_free_context( *ctx );
+            *ctx = NULL;
             return AVERROR(ENOMEM);
         }
     }
@@ -275,6 +277,7 @@ int mediaconv_demuxer_open( AVFormatContext **ctx, struct stream_context *contex
         if ((ret = avio_open( &(*ctx)->pb, blank_path, AVIO_FLAG_READ )) < 0)
         {
             avformat_free_context( *ctx );
+            *ctx = NULL;
             return ret;
         }
     }
-- 
2.51.1

