From 4a6c1b16266ca9ad9566fc6e847bd7ad7517d347 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Thu, 24 Jul 2025 01:10:41 -0400
Subject: [PATCH 220/341] HACK: ntoskrnl: Add hidusb driver stub.

---
 dlls/ntoskrnl.exe/ntoskrnl.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/dlls/ntoskrnl.exe/ntoskrnl.c b/dlls/ntoskrnl.exe/ntoskrnl.c
index 733a212bfba..84f8d16b214 100644
--- a/dlls/ntoskrnl.exe/ntoskrnl.c
+++ b/dlls/ntoskrnl.exe/ntoskrnl.c
@@ -5011,7 +5011,7 @@ BOOL WINAPI VslGetSecurePciEnabled(void)
     return TRUE;
 }
 
-static NTSTATUS WINAPI pci_driver_stub( DRIVER_OBJECT *driver, UNICODE_STRING *path )
+static NTSTATUS WINAPI driver_stub( DRIVER_OBJECT *driver, UNICODE_STRING *path )
 {
     FIXME("%p %s stub!\n", driver, debugstr_us(path));
 
@@ -5026,6 +5026,7 @@ BOOL WINAPI DllMain( HINSTANCE inst, DWORD reason, LPVOID reserved )
     static void *handler;
     LARGE_INTEGER count;
     UNICODE_STRING str = RTL_CONSTANT_STRING( L"\\Driver\\pci" );
+    UNICODE_STRING hidusb = RTL_CONSTANT_STRING( L"\\Driver\\hidusb" );
 
     switch(reason)
     {
@@ -5039,7 +5040,8 @@ BOOL WINAPI DllMain( HINSTANCE inst, DWORD reason, LPVOID reserved )
         ntoskrnl_heap = HeapCreate( HEAP_CREATE_ENABLE_EXECUTE, 0, 0 );
         dpc_call_tls_index = TlsAlloc();
         LdrRegisterDllNotification( 0, ldr_notify_callback, NULL, &ldr_notify_cookie );
-        IoCreateDriver(&str, pci_driver_stub);
+        IoCreateDriver(&str, driver_stub);
+        IoCreateDriver(&hidusb, driver_stub);
         break;
     case DLL_PROCESS_DETACH:
         LdrUnregisterDllNotification( ldr_notify_cookie );
-- 
2.50.1

