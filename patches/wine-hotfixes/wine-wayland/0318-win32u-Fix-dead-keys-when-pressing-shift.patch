From cd235fd74f7bf39c0ad55db302e22b7ef6be93a7 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Wed, 1 Oct 2025 22:56:28 -0500
Subject: [PATCH 318/409] win32u: Fix dead keys when pressing shift.

---
 dlls/win32u/input.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/dlls/win32u/input.c b/dlls/win32u/input.c
index dc8e97ed39b..c28f9829c2a 100644
--- a/dlls/win32u/input.c
+++ b/dlls/win32u/input.c
@@ -1344,13 +1344,14 @@ INT WINAPI NtUserToUnicodeEx( UINT virt, UINT scan, const BYTE *state,
     else
     {
         str[0] = kbd_tables_vkey_to_wchar( kbd_tables, virt, state, &is_dead );
-        thread->kbd_deadkey = is_dead ? str[0] : 0;
+        if (str[0] != WCH_NONE) thread->kbd_deadkey = is_dead ? str[0] : 0;
     }
     if (size > 1) str[1] = 0;
 
     if (str[0] != WCH_NONE) len = 1;
     else str[0] = len = 0;
 
+    /* TODO: Implement deadkey pressed twice */
     if (deadkey && !is_dead && len && str[0])
     {
         DEADKEY *key = kbd_tables->pDeadKey;
-- 
2.51.1

