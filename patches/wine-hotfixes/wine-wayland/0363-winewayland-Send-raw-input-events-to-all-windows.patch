From cb33b0584cec10eec18525b3b0eba2b4794570da Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Sun, 17 Aug 2025 14:20:29 -0400
Subject: [PATCH 363/365] winewayland: Send raw input events to all windows.

---
 dlls/winewayland.drv/wayland_pointer.c | 14 +++++++++++---
 1 file changed, 11 insertions(+), 3 deletions(-)

diff --git a/dlls/winewayland.drv/wayland_pointer.c b/dlls/winewayland.drv/wayland_pointer.c
index 8bb806da669..9737408b4ae 100644
--- a/dlls/winewayland.drv/wayland_pointer.c
+++ b/dlls/winewayland.drv/wayland_pointer.c
@@ -341,7 +341,6 @@ static void pointer_handle_axis(void *data, struct wl_pointer *wl_pointer,
     TRACE("hwnd=%p axis=%u value=%.2f\n", hwnd, axis, scroll_value);
 }
 
-/* FIXME: do we want to handle buttons here? */
 static void pointer_handle_frame(void *data, struct wl_pointer *wl_pointer)
 {
     HWND hwnd;
@@ -383,7 +382,12 @@ static void pointer_handle_frame(void *data, struct wl_pointer *wl_pointer)
         pointer->pointer_frame.dy -= input.mi.dy;
         input.mi.dwFlags = MOUSEEVENTF_MOVE;
         if (input.mi.dx != 0 || input.mi.dy != 0)
-            NtUserSendHardwareInput(hwnd, pointer->relative_only ? 0 : SEND_HWMSG_NO_MSG, &input, 0);
+        {
+            if (pointer->relative_only)
+                NtUserSendHardwareInput(hwnd, SEND_HWMSG_NO_RAW, &input, 0);
+
+            NtUserSendHardwareInput(0, SEND_HWMSG_NO_MSG, &input, 0);
+        }
     }
 
     /* zero these values just in case */
@@ -410,9 +414,13 @@ static void pointer_handle_frame(void *data, struct wl_pointer *wl_pointer)
 
     if (pointer->pointer_frame.flags & WAYLAND_POINTER_FRAME_BUTTON)
     {
+        /* raw button input */
         input.mi.mouseData = pointer->pointer_frame.button_data;
         input.mi.dwFlags = pointer->pointer_frame.button_flags;
-        NtUserSendHardwareInput(hwnd, 0, &input, 0);
+        NtUserSendHardwareInput(0, SEND_HWMSG_NO_MSG, &input, 0);
+
+        /* normal button input */
+        NtUserSendHardwareInput(hwnd, SEND_HWMSG_NO_RAW, &input, 0);
     }
 
 skip:
-- 
2.50.1

