From 2118e2ccfe5c71c0b2f15a46c592ac1a11c478b1 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Mon, 1 Sep 2025 17:04:15 -0500
Subject: [PATCH 316/378] amdxc: Add support for MLSR-WATERMARK env.

---
 dlls/amdxc64/main.c | 22 +++++++++++++++++++++-
 1 file changed, 21 insertions(+), 1 deletion(-)

diff --git a/dlls/amdxc64/main.c b/dlls/amdxc64/main.c
index 6df95578748..4b04848a862 100644
--- a/dlls/amdxc64/main.c
+++ b/dlls/amdxc64/main.c
@@ -390,7 +390,7 @@ HRESULT STDMETHODCALLTYPE AmdExtD3DFactory_CreateInterface(IAmdExtD3DFactory *if
 
 HRESULT STDMETHODCALLTYPE AmdExtD3DFactory_QueryInterface(IAmdExtD3DFactory *iface, REFIID iid, void **out)
 {
-    TRACE("%p %s %p", iface, debugstr_guid(iid), out);
+    TRACE("%p %s %p\n", iface, debugstr_guid(iid), out);
     return E_NOINTERFACE;
 }
 
@@ -431,3 +431,23 @@ HMODULE WINAPI AmdGetDxcModuleHandle(void)
 {
     return GetModuleHandleA(NULL);
 }
+
+BOOL WINAPI DllMain(HINSTANCE inst, DWORD reason, void *reserved)
+{
+    const char *env;
+
+    switch (reason)
+    {
+        case DLL_PROCESS_ATTACH:
+        {
+            if ((env = getenv("FSR4_WATERMARK")) && !strcmp(env, "1"))
+            {
+                _putenv("MLSR-WATERMARK=1");
+            }
+            break;
+        }
+        default: break;
+    }
+
+    return TRUE;
+}
-- 
2.51.0

