From ec583fc5fe3592bd991609ad1e88c2b564c36fd6 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Thu, 14 Aug 2025 17:46:09 -0400
Subject: [PATCH 309/327] winewayland: Add support for wp_content_type_v1 on
 client surfaces.

---
 dlls/winewayland.drv/wayland_surface.c | 14 ++++++++++++++
 dlls/winewayland.drv/waylanddrv.h      |  1 +
 2 files changed, 15 insertions(+)

diff --git a/dlls/winewayland.drv/wayland_surface.c b/dlls/winewayland.drv/wayland_surface.c
index 302fcb7b663..effb570a21d 100644
--- a/dlls/winewayland.drv/wayland_surface.c
+++ b/dlls/winewayland.drv/wayland_surface.c
@@ -1134,6 +1134,8 @@ BOOL wayland_client_surface_release(struct wayland_client_surface *client)
 {
     if (InterlockedDecrement(&client->ref)) return FALSE;
 
+    if (client->wp_content_type_v1)
+        wp_content_type_v1_destroy(client->wp_content_type_v1);
     if (client->wp_viewport)
         wp_viewport_destroy(client->wp_viewport);
     if (client->wl_subsurface)
@@ -1187,6 +1189,18 @@ struct wayland_client_surface *wayland_client_surface_create(HWND hwnd)
         goto err;
     }
 
+    if (process_wayland.wp_content_type_manager_v1)
+    {
+        TRACE("setting game content on client surface!\n");
+        client->wp_content_type_v1 =
+            wp_content_type_manager_v1_get_surface_content_type(
+                process_wayland.wp_content_type_manager_v1,
+                client->wl_surface
+            );
+        wp_content_type_v1_set_content_type(client->wp_content_type_v1,
+                                            WP_CONTENT_TYPE_V1_TYPE_GAME);
+    }
+
     return client;
 
 err:
diff --git a/dlls/winewayland.drv/waylanddrv.h b/dlls/winewayland.drv/waylanddrv.h
index 9580fc1b596..d69df10c11b 100644
--- a/dlls/winewayland.drv/waylanddrv.h
+++ b/dlls/winewayland.drv/waylanddrv.h
@@ -305,6 +305,7 @@ struct wayland_client_surface
     struct wl_surface *wl_surface;
     struct wl_subsurface *wl_subsurface;
     struct wp_viewport *wp_viewport;
+    struct wp_content_type_v1 *wp_content_type_v1;
 };
 
 struct wayland_shm_buffer
-- 
2.51.0

