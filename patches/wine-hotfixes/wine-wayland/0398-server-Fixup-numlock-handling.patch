From d35a2f144c10ebc5cbdaa7dd076d00ce58d6951f Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Wed, 26 Nov 2025 19:25:35 -0600
Subject: [PATCH 398/406] server: Fixup numlock handling.

---
 server/queue.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/server/queue.c b/server/queue.c
index ad6547a2bce..ea9796f75c8 100644
--- a/server/queue.c
+++ b/server/queue.c
@@ -2543,8 +2543,8 @@ static int queue_keyboard_message( struct desktop *desktop, user_handle_t win, c
     }
 
     /* send numpad vkeys if NumLock is active */
-    if ((input->kbd.vkey & KBDNUMPAD) && (desktop->keystate[VK_NUMLOCK] & 0x01) &&
-        !(desktop->keystate[VK_SHIFT] & 0x80))
+    if ((input->kbd.vkey & KBDNUMPAD) && (desktop_shm->keystate[VK_NUMLOCK] & 0x80) &&
+        !(desktop_shm->keystate[VK_SHIFT] & 0x80))
     {
        switch (vkey)
        {
-- 
2.51.1

