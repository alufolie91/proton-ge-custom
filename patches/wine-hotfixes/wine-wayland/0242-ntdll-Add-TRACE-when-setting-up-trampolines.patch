From 46c96ae6f405c0f811dc9e3b6b1a8e53c4da78d0 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Sun, 10 Aug 2025 21:53:04 -0400
Subject: [PATCH 242/410] ntdll: Add TRACE when setting up trampolines

---
 dlls/ntdll/loader.c      | 1 +
 dlls/ntdll/unix/loader.c | 2 ++
 2 files changed, 3 insertions(+)

diff --git a/dlls/ntdll/loader.c b/dlls/ntdll/loader.c
index 1521900e752..12fd8c43ec9 100644
--- a/dlls/ntdll/loader.c
+++ b/dlls/ntdll/loader.c
@@ -2341,6 +2341,7 @@ static NTSTATUS build_module( LPCWSTR load_path, const UNICODE_STRING *nt_name,
         (lsteamclient || LdrLoadDll(load_path, 0, &lsteamclient_us, &lsteamclient) == STATUS_SUCCESS))
     {
         struct steamclient_setup_trampolines_params params = {.src_mod = *module, .tgt_mod = lsteamclient};
+        TRACE("setting up trampolines for %p (%s)\n", *module, debugstr_wn(basename, basename_len));
         WINE_UNIX_CALL( unix_steamclient_setup_trampolines, &params );
         if (is_steamclient32)
         {
diff --git a/dlls/ntdll/unix/loader.c b/dlls/ntdll/unix/loader.c
index f5efad48bda..c5690ba7b08 100644
--- a/dlls/ntdll/unix/loader.c
+++ b/dlls/ntdll/unix/loader.c
@@ -650,6 +650,8 @@ NTSTATUS exec_wineloader( char **argv, int socketfd, const struct pe_image_info
         strcpy( env, "LD_PRELOAD=" );
         strcat( env, ld_preload );
 
+        TRACE("HACK: Unsetting LD_PRELOAD for explorer.exe\n");
+
         tmp = env + 11;
         do
         {
-- 
2.51.1

