From 54a995931742a6139f1442a9b87e94a83317b01a Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Thu, 15 Jan 2026 23:39:53 -0500
Subject: [PATCH 478/479] user32: Implement dead key support for
 MapVirtualKeyExA.

---
 dlls/user32/input.c | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/dlls/user32/input.c b/dlls/user32/input.c
index 6a7bee55ce7..47f47f83ca2 100644
--- a/dlls/user32/input.c
+++ b/dlls/user32/input.c
@@ -288,18 +288,22 @@ UINT WINAPI MapVirtualKeyW(UINT code, UINT maptype)
  */
 UINT WINAPI MapVirtualKeyExA(UINT code, UINT maptype, HKL hkl)
 {
+    UINT top_bit = 0;
     UINT ret;
 
     ret = NtUserMapVirtualKeyEx( code, maptype, hkl );
     if (maptype == MAPVK_VK_TO_CHAR)
     {
         BYTE ch = 0;
-        WCHAR wch = ret;
+        WCHAR wch;
+
+        top_bit = ret & (1u << 31);
+        wch = ret & ~top_bit;
 
         WideCharToMultiByte( CP_ACP, 0, &wch, 1, (LPSTR)&ch, 1, NULL, NULL );
         ret = ch;
     }
-    return ret;
+    return ret | top_bit;
 }
 
 /****************************************************************************
-- 
2.52.0

