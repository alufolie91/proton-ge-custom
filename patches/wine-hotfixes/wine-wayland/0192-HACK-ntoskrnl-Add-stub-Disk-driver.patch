From ca6f582eedada5e7469e2165a16e4e1b14e693e8 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Thu, 24 Jul 2025 18:27:53 -0400
Subject: [PATCH 192/406] HACK: ntoskrnl: Add stub Disk driver.

---
 dlls/ntoskrnl.exe/ntoskrnl.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/dlls/ntoskrnl.exe/ntoskrnl.c b/dlls/ntoskrnl.exe/ntoskrnl.c
index 14bb2d4cb77..34d54d0abfa 100644
--- a/dlls/ntoskrnl.exe/ntoskrnl.c
+++ b/dlls/ntoskrnl.exe/ntoskrnl.c
@@ -5048,6 +5048,7 @@ BOOL WINAPI DllMain( HINSTANCE inst, DWORD reason, LPVOID reserved )
     LARGE_INTEGER count;
     UNICODE_STRING str = RTL_CONSTANT_STRING( L"\\Driver\\pci" );
     UNICODE_STRING hidusb = RTL_CONSTANT_STRING( L"\\Driver\\hidusb" );
+    UNICODE_STRING disk = RTL_CONSTANT_STRING( L"\\Driver\\Disk" );
 
     switch(reason)
     {
@@ -5063,6 +5064,7 @@ BOOL WINAPI DllMain( HINSTANCE inst, DWORD reason, LPVOID reserved )
         LdrRegisterDllNotification( 0, ldr_notify_callback, NULL, &ldr_notify_cookie );
         IoCreateDriver(&str, driver_stub);
         IoCreateDriver(&hidusb, driver_stub);
+        IoCreateDriver(&disk, driver_stub);
         break;
     case DLL_PROCESS_DETACH:
         LdrUnregisterDllNotification( ldr_notify_cookie );
-- 
2.51.1

