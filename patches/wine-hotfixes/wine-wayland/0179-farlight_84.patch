From a61cc57d8687f90dd780c82b5ac62dd00f8f36f8 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Thu, 7 Aug 2025 22:45:33 -0400
Subject: [PATCH] ntdll: Implement RtlAreLongPathsEnabled.

---
 dlls/ntdll/ntdll.spec | 1 +
 dlls/ntdll/rtl.c      | 8 ++++++++
 dlls/ntdll/unix/env.c | 2 ++
 3 files changed, 11 insertions(+)

diff --git a/dlls/ntdll/ntdll.spec b/dlls/ntdll/ntdll.spec
index 1e6db465734..7b5fb82205d 100644
--- a/dlls/ntdll/ntdll.spec
+++ b/dlls/ntdll/ntdll.spec
@@ -527,6 +527,7 @@
 @ stdcall RtlAreAnyAccessesGranted(long long)
 @ stdcall RtlAreBitsClear(ptr long long)
 @ stdcall RtlAreBitsSet(ptr long long)
+@ stdcall RtlAreLongPathsEnabled()
 # @ stub RtlAssert2
 @ stdcall RtlAssert(ptr ptr long str)
 # @ stub RtlCancelTimer
diff --git a/dlls/ntdll/rtl.c b/dlls/ntdll/rtl.c
index deee078faa2..cc301aaa234 100644
--- a/dlls/ntdll/rtl.c
+++ b/dlls/ntdll/rtl.c
@@ -1104,6 +1104,14 @@ void WINAPI RtlGetDeviceFamilyInfoEnum(ULONGLONG *version, DWORD *family, DWORD
     if (form) *form = DEVICEFAMILYDEVICEFORM_UNKNOWN;
 }
 
+/*********************************************************************
+ *           RtlAreLongPathsEnabled [NTDLL.@]
+ */
+BOOL WINAPI RtlAreLongPathsEnabled(void)
+{
+    return NtCurrentTeb()->Peb->IsLongPathAwareProcess;
+}
+
 /*********************************************************************
  *           RtlConvertDeviceFamilyInfoToString [NTDLL.@]
  */
diff --git a/dlls/ntdll/unix/env.c b/dlls/ntdll/unix/env.c
index 98389c75ca6..6d27e9caa02 100644
--- a/dlls/ntdll/unix/env.c
+++ b/dlls/ntdll/unix/env.c
@@ -1920,6 +1920,7 @@ static void init_peb( RTL_USER_PROCESS_PARAMETERS *params, void *module )
     peb->ImageSubSystem             = main_image_info.SubSystemType;
     peb->ImageSubSystemMajorVersion = main_image_info.MajorSubsystemVersion;
     peb->ImageSubSystemMinorVersion = main_image_info.MinorSubsystemVersion;
+    peb->IsLongPathAwareProcess     = TRUE;
 
 #ifdef _WIN64
     switch (main_image_info.Machine)
@@ -1963,6 +1964,7 @@ static void init_peb( RTL_USER_PROCESS_PARAMETERS *params, void *module )
         wow_peb->ImageSubSystemMajorVersion      = peb->ImageSubSystemMajorVersion;
         wow_peb->ImageSubSystemMinorVersion      = peb->ImageSubSystemMinorVersion;
         wow_peb->SessionId                       = peb->SessionId;
+        wow_peb->IsLongPathAwareProcess          = peb->IsLongPathAwareProcess;
     }
 }
 
From 56a11254ac4bc77dd33780fc8394492dc7b4cf32 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Thu, 7 Aug 2025 23:06:47 -0400
Subject: [PATCH] iphlpapi: Add some stubs.

---
 dlls/iphlpapi/iphlpapi.spec   |  4 ++--
 dlls/iphlpapi/iphlpapi_main.c | 19 +++++++++++++++++++
 2 files changed, 21 insertions(+), 2 deletions(-)

diff --git a/dlls/iphlpapi/iphlpapi.spec b/dlls/iphlpapi/iphlpapi.spec
index facb52e0448..d22c82075dd 100644
--- a/dlls/iphlpapi/iphlpapi.spec
+++ b/dlls/iphlpapi/iphlpapi.spec
@@ -106,7 +106,7 @@
 @ stdcall GetIpForwardTable( ptr ptr long )
 @ stdcall GetIpForwardTable2( long ptr )
 @ stub GetIpForwardTableFromStack
-#@ stub GetIpInterfaceEntry
+@ stdcall GetIpInterfaceEntry(ptr)
 @ stdcall GetIpInterfaceTable( long ptr )
 #@ stub GetIpNetEntry2
 @ stdcall GetIpNetTable( ptr ptr long )
@@ -153,7 +153,7 @@
 @ stdcall GetUnicastIpAddressTable(long ptr)
 @ stdcall GetUniDirectionalAdapterInfo( ptr ptr )
 @ stdcall Icmp6CreateFile()
-#@ stub Icmp6ParseReplies
+@ stdcall Icmp6ParseReplies(ptr long)
 @ stdcall Icmp6SendEcho2(ptr ptr ptr ptr ptr ptr ptr long ptr ptr long long)
 @ stdcall IcmpCloseHandle(ptr)
 @ stdcall IcmpCreateFile()
diff --git a/dlls/iphlpapi/iphlpapi_main.c b/dlls/iphlpapi/iphlpapi_main.c
index 78000a628b7..9c64085638e 100644
--- a/dlls/iphlpapi/iphlpapi_main.c
+++ b/dlls/iphlpapi/iphlpapi_main.c
@@ -4539,6 +4539,15 @@ DWORD WINAPI GetIpInterfaceTable(ADDRESS_FAMILY family, PMIB_IPINTERFACE_TABLE *
     return ERROR_NOT_SUPPORTED;
 }
 
+/******************************************************************
+ *    GetIpInterfaceEntry (IPHLPAPI.@)
+ */
+DWORD WINAPI GetIpInterfaceEntry(MIB_IPINTERFACE_ROW *row)
+{
+    FIXME("(%p): stub\n", row);
+    return ERROR_NOT_SUPPORTED;
+}
+
 /******************************************************************
  *    GetBestRoute2 (IPHLPAPI.@)
  */
@@ -4850,6 +4859,16 @@ DWORD WINAPI Icmp6SendEcho2( HANDLE handle, HANDLE event, PIO_APC_ROUTINE apc_ro
     return 0;
 }
 
+/***********************************************************************
+ *    Icmp6ParseReplies (IPHLPAPI.@)
+ */
+DWORD WINAPI Icmp6ParseReplies(void *reply, DWORD length)
+{
+    FIXME("%p %lx\n", reply, length);
+    SetLastError( ERROR_CALL_NOT_IMPLEMENTED );
+    return 0;
+}
+
 /***********************************************************************
  *    GetCurrentThreadCompartmentId (IPHLPAPI.@)
  */
From b10331c25fc44abf4164d870dba70034a35f783b Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Thu, 7 Aug 2025 23:22:52 -0400
Subject: [PATCH] sechost: Add stubs for ControlServiceExA/W

---
 dlls/advapi32/advapi32.spec |  4 ++--
 dlls/sechost/sechost.spec   |  4 ++--
 dlls/sechost/service.c      | 20 ++++++++++++++++++++
 3 files changed, 24 insertions(+), 4 deletions(-)

diff --git a/dlls/advapi32/advapi32.spec b/dlls/advapi32/advapi32.spec
index dde83cc7045..94c4f607972 100644
--- a/dlls/advapi32/advapi32.spec
+++ b/dlls/advapi32/advapi32.spec
@@ -106,8 +106,8 @@
 @ stdcall CommandLineFromMsiDescriptor(wstr ptr ptr)
 # @ stub ComputeAccessTokenFromCodeAuthzLevel
 @ stdcall -import ControlService(long long ptr)
-# @ stub ControlServiceExA
-# @ stub ControlServiceExW
+@ stdcall -import ControlServiceExA(long long long ptr)
+@ stdcall -import ControlServiceExW(long long long ptr)
 @ stdcall -import ControlTraceA(int64 str ptr long)
 @ stdcall -import ControlTraceW(int64 wstr ptr long)
 # @ stub ConvertAccessToSecurityDescriptorA
diff --git a/dlls/sechost/sechost.spec b/dlls/sechost/sechost.spec
index 12f4ff64412..0f83208706f 100644
--- a/dlls/sechost/sechost.spec
+++ b/dlls/sechost/sechost.spec
@@ -26,8 +26,8 @@
 @ stdcall CloseServiceHandle(long)
 @ stdcall CloseTrace(int64)
 @ stdcall ControlService(long long ptr)
-@ stub ControlServiceExA
-@ stub ControlServiceExW
+@ stdcall ControlServiceExA(long long long ptr)
+@ stdcall ControlServiceExW(long long long ptr)
 @ stdcall ControlTraceA(int64 str ptr long)
 @ stdcall ControlTraceW(int64 wstr ptr long)
 @ stub ConvertSDToStringSDRootDomainW
diff --git a/dlls/sechost/service.c b/dlls/sechost/service.c
index aa358925eb5..0ebf354db4f 100644
--- a/dlls/sechost/service.c
+++ b/dlls/sechost/service.c
@@ -1089,6 +1089,26 @@ BOOL WINAPI DECLSPEC_HOTPATCH ControlService( SC_HANDLE service, DWORD control,
     return set_error( err );
 }
 
+/******************************************************************************
+ *     ControlServiceExA   (sechost.@)
+ */
+BOOL WINAPI DECLSPEC_HOTPATCH ControlServiceExA( SC_HANDLE service, DWORD control, DWORD level, void *params)
+{
+    FIXME( "%p %ld %ld %p stub!\n", service, control, level, params );
+
+    return set_error( ERROR_CALL_NOT_IMPLEMENTED );
+}
+
+/******************************************************************************
+ *     ControlServiceExW   (sechost.@)
+ */
+BOOL WINAPI DECLSPEC_HOTPATCH ControlServiceExW( SC_HANDLE service, DWORD control, DWORD level, void *params)
+{
+    FIXME( "%p %ld %ld %p stub!\n", service, control, level, params );
+
+    return set_error( ERROR_CALL_NOT_IMPLEMENTED );
+}
+
 /******************************************************************************
  *     QueryServiceStatus   (sechost.@)
  */
