From a6654d4e5c58b8b291166ddc0e255ee1e42c5b72 Mon Sep 17 00:00:00 2001
From: Kun Yang <yangkun@uniontech.com>
Date: Mon, 17 Mar 2025 10:58:30 +0800
Subject: [PATCH 269/409] msvcrt: Add MSVCRT__NOBUF flag check in _filbuf to
 avoid dead loop in application which sets the flag.

Signed-off-by: Kun Yang <yangkun@uniontech.com>
---
 dlls/msvcrt/file.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/dlls/msvcrt/file.c b/dlls/msvcrt/file.c
index 8a8196fa57e..ce2c9fe690d 100644
--- a/dlls/msvcrt/file.c
+++ b/dlls/msvcrt/file.c
@@ -3853,7 +3853,7 @@ int CDECL _filbuf(FILE* file)
             return EOF;
     }
 
-    if(!(file->_flag & (_IOMYBUF | MSVCRT__USERBUF))) {
+    if(!(file->_flag & (MSVCRT__NOBUF | _IOMYBUF | MSVCRT__USERBUF))) {
         int r;
         if ((r = _read(file->_file,&c,1)) != 1) {
             file->_flag |= (r == 0) ? _IOEOF : _IOERR;
-- 
2.51.1

