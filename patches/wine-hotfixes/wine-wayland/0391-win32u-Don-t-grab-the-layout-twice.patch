From 8b5ea0708bab74d2fa96f244573a10e2ec669723 Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Wed, 19 Nov 2025 01:26:46 -0600
Subject: [PATCH 391/423] win32u: Don't grab the layout twice.

---
 dlls/win32u/input.c | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/dlls/win32u/input.c b/dlls/win32u/input.c
index 26d09535121..6abeaf89109 100644
--- a/dlls/win32u/input.c
+++ b/dlls/win32u/input.c
@@ -1308,9 +1308,8 @@ INT WINAPI NtUserGetKeyNameText( LONG lparam, WCHAR *buffer, INT size )
     }
     else if (size > 1)
     {
-        HKL hkl = NtUserGetKeyboardLayout( 0 );
-        vkey = NtUserMapVirtualKeyEx( code & 0xff, MAPVK_VSC_TO_VK, hkl );
-        buffer[0] = NtUserMapVirtualKeyEx( vkey, MAPVK_VK_TO_CHAR, hkl );
+        vkey = NtUserMapVirtualKeyEx( code & 0xff, MAPVK_VSC_TO_VK, layout );
+        buffer[0] = NtUserMapVirtualKeyEx( vkey, MAPVK_VK_TO_CHAR, layout );
         len = buffer[0] ? 1 : 0;
     }
     buffer[len] = 0;
-- 
2.52.0

