From 5e01392f80619b4bf945bf0a44fb9cb65ea51ecd Mon Sep 17 00:00:00 2001
From: Etaash Mathamsetty
 <45927311+Etaash-mathamsetty@users.noreply.github.com>
Date: Tue, 27 May 2025 00:08:02 -0400
Subject: [PATCH 081/365] winebus: Ignore steam input virtual controller when
 PROTON_PREFER_SDL is set.

---
 dlls/winebus.sys/bus_udev.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/dlls/winebus.sys/bus_udev.c b/dlls/winebus.sys/bus_udev.c
index a324f49d2d7..dc71a119093 100644
--- a/dlls/winebus.sys/bus_udev.c
+++ b/dlls/winebus.sys/bus_udev.c
@@ -1703,7 +1703,15 @@ static void udev_add_device(struct udev_device *dev, int fd)
     }
 
     if (desc.vid == 0x28de && desc.pid == 0x11ff && !strcmp(subsystem, "input"))
-        TRACE("evdev %s: detected steam input virtual controller\n", debugstr_a(devnode));
+    {
+        char *env = getenv("PROTON_PREFER_SDL");
+        if (env && !strcmp(env, "1"))
+        {
+            TRACE("evdev %s: gnoring steam input virtual controller\n", debugstr_a(devnode));
+            close(fd);
+            return;
+        }
+    }
     else if (is_sdl_ignored_device(desc.vid, desc.pid))
     {
         TRACE("evdev %s: ignoring %s, in SDL ignore list\n", debugstr_a(devnode), debugstr_device_desc(&desc));
-- 
2.50.1

