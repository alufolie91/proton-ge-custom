From 270f433514ab9ae02a8a883250283a32370385c5 Mon Sep 17 00:00:00 2001
From: Nikolay Sivov <nsivov@codeweavers.com>
Date: Sat, 12 Apr 2025 21:21:49 +0200
Subject: [PATCH 244/327] combase: Add a stub for SetRestrictedErrorInfo().

Foobar 2000 crashes without it.

Signed-off-by: Nikolay Sivov <nsivov@codeweavers.com>
---
 dlls/combase/combase.spec | 2 +-
 dlls/combase/roapi.c      | 9 +++++++++
 include/roerrorapi.h      | 1 +
 3 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/dlls/combase/combase.spec b/dlls/combase/combase.spec
index 4bdc14334e2..ae13be7e6cc 100644
--- a/dlls/combase/combase.spec
+++ b/dlls/combase/combase.spec
@@ -319,7 +319,7 @@
 @ stub RoUnregisterForApartmentShutdown
 @ stub SetCleanupFlag
 @ stdcall SetErrorInfo(long ptr)
-@ stub SetRestrictedErrorInfo
+@ stdcall SetRestrictedErrorInfo(ptr)
 @ stdcall StringFromCLSID(ptr ptr)
 @ stdcall StringFromGUID2(ptr ptr long)
 @ stdcall StringFromIID(ptr ptr) StringFromCLSID
diff --git a/dlls/combase/roapi.c b/dlls/combase/roapi.c
index 0f8a9438821..8118758d338 100644
--- a/dlls/combase/roapi.c
+++ b/dlls/combase/roapi.c
@@ -480,6 +480,15 @@ HRESULT WINAPI GetRestrictedErrorInfo(IRestrictedErrorInfo **info)
     return E_NOTIMPL;
 }
 
+/***********************************************************************
+ *      SetRestrictedErrorInfo (combase.@)
+ */
+HRESULT WINAPI SetRestrictedErrorInfo(IRestrictedErrorInfo *info)
+{
+    FIXME( "(%p)\n", info );
+    return E_NOTIMPL;
+}
+
 /***********************************************************************
  *      RoOriginateLanguageException (combase.@)
  */
diff --git a/include/roerrorapi.h b/include/roerrorapi.h
index 741347455b1..21fe4eb09dc 100644
--- a/include/roerrorapi.h
+++ b/include/roerrorapi.h
@@ -36,5 +36,6 @@ HRESULT WINAPI GetRestrictedErrorInfo(IRestrictedErrorInfo **info);
 BOOL    WINAPI RoOriginateError(HRESULT error, HSTRING message);
 BOOL    WINAPI RoOriginateLanguageException(HRESULT error, HSTRING message, IUnknown *language_exception);
 HRESULT WINAPI RoSetErrorReportingFlags(UINT32 flags);
+HRESULT WINAPI SetRestrictedErrorInfo(IRestrictedErrorInfo *info);
 
 #endif /* _ROERROR_H */
-- 
2.51.0

