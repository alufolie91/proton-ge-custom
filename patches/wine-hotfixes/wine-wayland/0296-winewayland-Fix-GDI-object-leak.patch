From 6059e106ae2f09fcca57c1417eb4bd2bcb578235 Mon Sep 17 00:00:00 2001
From: Alexandros Frantzis <alexandros.frantzis@collabora.com>
Date: Thu, 4 Sep 2025 14:36:55 +0300
Subject: [PATCH 296/377] winewayland: Fix GDI object leak.

Co-authored-by: mata <sutupud@yahoo.com>
Wine-Bug: https://bugs.winehq.org/show_bug.cgi?id=58503
---
 dlls/winewayland.drv/wayland_pointer.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/dlls/winewayland.drv/wayland_pointer.c b/dlls/winewayland.drv/wayland_pointer.c
index e7e58a8bfc2..e904cb57946 100644
--- a/dlls/winewayland.drv/wayland_pointer.c
+++ b/dlls/winewayland.drv/wayland_pointer.c
@@ -921,7 +921,12 @@ static BOOL wayland_pointer_set_cursor_shape(HCURSOR hcursor)
         process_wayland.wp_cursor_shape_manager_v1);
     /* HACK: KDE doesn't support v2 shapes despite advertising v2 */
     if (WAYLAND_HasWindowManager("KDE")) proto_version = 1;
-    if (!(shape = cursor_shape_from_info(&info, proto_version))) return FALSE;
+    shape = cursor_shape_from_info(&info, proto_version);
+
+    if (info.hbmColor) NtGdiDeleteObjectApp(info.hbmColor);
+    if (info.hbmMask) NtGdiDeleteObjectApp(info.hbmMask);
+
+    if (!shape) return FALSE;
 
     if (!pointer->wp_cursor_shape_device_v1)
     {
-- 
2.51.0

